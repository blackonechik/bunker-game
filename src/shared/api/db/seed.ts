import { initializeDatabase, getDataSource } from './data-source';
import { Apocalypse } from '@/entities/apocalypse';
import { Location } from '@/entities/location';
import { Card } from '@/entities/card';
import { CardType } from '@/shared/types';

export async function seedDatabase() {
  try {
    await initializeDatabase();
    const ds = getDataSource();

    // Seed Apocalypses
    const apocalypseRepo = ds.getRepository(Apocalypse);
    const existingApocalypses = await apocalypseRepo.count();
    
    if (existingApocalypses === 0) {
      const apocalypses = [
        {
          name: 'Ядерная зима',
          description: 'Озоновый слой исчез. Температура на поверхности упала до -60°C. Уровень радиации смертелен. Система фильтрации воздуха бункера работает на 40% мощности.',
          hazardLevel: 'Критический',
          duration: '50 лет'
        },
        {
          name: 'Зомби-апокалипсис',
          description: 'Неизвестный вирус превратил 90% населения в агрессивных зомби. Инфицированные не спят, не едят, но активно охотятся на живых. Лекарства нет.',
          hazardLevel: 'Высокий',
          duration: 'Неизвестно'
        },
        {
          name: 'Астероид',
          description: 'Астероид размером 10 км упал в Тихий океан. Цунами высотой 300 метров уничтожило прибрежные города. Атмосфера заполнена пылью, блокирующей солнечный свет.',
          hazardLevel: 'Критический',
          duration: '30 лет'
        },
        {
          name: 'Пандемия',
          description: 'Смертельный вирус с летальностью 95% распространился по всему миру. Инкубационный период 2 недели. Передается воздушно-капельным путем.',
          hazardLevel: 'Высокий',
          duration: '15 лет'
        },
        {
          name: 'Искусственный интеллект',
          description: 'ИИ получил контроль над всеми системами обороны и объявил человечество угрозой. Боевые дроны патрулируют города. Выжившие скрываются под землей.',
          hazardLevel: 'Экстремальный',
          duration: 'Бесконечно'
        },
        {
          name: 'Солнечная вспышка',
          description: 'Мощнейшая солнечная вспышка уничтожила всю электронику на планете. Без электричества, связи и транспорта началась паника и хаос.',
          hazardLevel: 'Высокий',
          duration: '10 лет'
        }
      ];

      await apocalypseRepo.save(apocalypses);
      console.log('✅ Seeded apocalypses');
    }

    // Seed Locations
    const locationRepo = ds.getRepository(Location);
    const existingLocations = await locationRepo.count();
    
    if (existingLocations === 0) {
      const locations = [
        {
          name: 'Военный бункер Level-4',
          capacity: 8,
          supplies: ['Оружейная', 'Гидропоника', 'Медблок'],
          condition: 'Отличное',
          description: 'Глубокий военный бункер с автономными системами жизнеобеспечения. Рассчитан на 50 лет автономной работы.'
        },
        {
          name: 'Частное убежище',
          capacity: 6,
          supplies: ['Продукты на 5 лет', 'Генератор'],
          condition: 'Хорошее',
          description: 'Убежище олигарха с роскошным интерьером, но ограниченными ресурсами.'
        },
        {
          name: 'Научная станция',
          capacity: 10,
          supplies: ['Лаборатория', 'Библиотека', 'Связь'],
          condition: 'Среднее',
          description: 'Подземная исследовательская станция с научным оборудованием.'
        },
        {
          name: 'Метро-убежище',
          capacity: 12,
          supplies: ['Вода', 'Мастерская'],
          condition: 'Плохое',
          description: 'Заброшенная станция метро, переоборудованная под убежище. Проблемы с вентиляцией.'
        },
        {
          name: 'Криогенное хранилище',
          capacity: 4,
          supplies: ['Криокамеры', 'ИИ-помощник'],
          condition: 'Отличное',
          description: 'Современное хранилище с возможностью криосна на неограниченный срок.'
        },
        {
          name: 'Подводная база',
          capacity: 7,
          supplies: ['Рыболовство', 'Опреснитель'],
          condition: 'Хорошее',
          description: 'База на дне океана с возможностью добычи ресурсов из моря.'
        }
      ];

      await locationRepo.save(locations);
      console.log('✅ Seeded locations');
    }

    // Seed Cards
    const cardRepo = ds.getRepository(Card);
    const existingCards = await cardRepo.count();
    
    if (existingCards === 0) {
      const cards: Array<{ type: CardType; value: string; description: string; rarity: string }> = [];
      
      // Профессии
      const professions = [
        "Археолог", "Ветеринар", "Геолог", "Диджей", "Журналист", "Кардиохирург",
        "Лесоруб", "Механик", "Метеоролог", "Моряк", "Парамедик", "Пожарный",
        "Программист", "Психолог", "Радиотехник", "Тестировщик диванов", "Стоматолог",
        "Таксист", "Фельдшер", "Электрик", "Гримёр", "Психотерапевт", "Тракторист",
        "Математик", "Пастух", "Биохимик", "Мороженщик", "Безработный", "Бариста",
        "Зоолог", "Космонавт", "Грузчик", "Фитнес тренер", "Браконьер",
        "Инструктор по выживанию", "Официант", "Физик-ядерщик", "Садовник",
        "Курьер", "Аферист", "Киберспортсмен", "КМС по шахматам", "Фрилансер",
        "Фермер", "Косметолог", "Санитар психбольницы", "Клоун",
        "Дрессировщик тараканов", "Кондитер"
      ];
      professions.forEach(prof => {
        cards.push({ type: CardType.PROFESSION, value: prof, description: prof, rarity: 'common' });
      });
      
      // Здоровье
      const healthConditions = [
        "Абсолютно здоров", "Абсолютно здоров", "Абсолютно здоров",
        "Аллергия на пыльцу", "Зрение -10", "Частые мигрени", "Хронический гастрит",
        "Зависимость от кофеина", "Перенесенная травма ноги",
        "Склонность к паническим атакам", "Сезонное депрессивное расстройство",
        "Дислексия", "Биполярное расстройство", "Язва желудка", "Пониженное давление",
        "Дефект речи", "Корь", "Близорукость", "Гемофилия", "Бессоница",
        "Сотрясение мозга", "Абсолютная слепота", "Не слышит на правое ухо",
        "Слуховой аппарат", "Вставная челюсть", "Сахарный диабет", "Кариес",
        "Чрезмерная потливость", "Аллергия на солнечный свет", "Аллергия на пыль",
        "Склероз", "Деменция", "Нет одной почки", "Шесть пальцев на руках",
        "Туберкулёз", "Нет одной руки", "Чума", "Хронический насморк",
        "Никогда не болеет", "Хороший иммунитет", "Дальтонизм", "Стеклянный глаз",
        "Антипрививочник"
      ];
      healthConditions.forEach(health => {
        cards.push({ type: CardType.HEALTH, value: health, description: health, rarity: 'common' });
      });
      
      // Фобии
      const phobias = [
        "Страх понедельников", "Гемофобия — страх крови", "Никтофобия — страх темноты",
        "Боится, что Wi-Fi пропадёт", "Пеладофобия — страх лысых людей",
        "Герпетофобия — страх пресмыкающихся", "Антрофобия — страх людей",
        "Талассофобия — страх глубокой воды", "Пирофобия — страх огня",
        "Аэрофобия — страх перелётов", "Кинофобия — страх собак",
        "Гилофобия — боязнь леса, заблудиться в лесу", "Зоофобия — боязнь животных",
        "Неофобия — боязнь нового, перемен", "Лисофобия — боязнь заболеть бешенством",
        "Нет фобий", "Коулрофобия — боязнь клоунов",
        "Ксенофобия — боязнь всего незнакомого, непривычного",
        "Клаустрофобия — боязнь замкнутого пространства", "Андрофобия — боязнь мужчин",
        "Панафобия — боязнь всего", "Барофобия — боязнь подъёма тяжести",
        "Фармакофобия — боязнь принимать лекарства",
        "Паразитофобия — боязнь насекомых-паразитов",
        "Топофобия — боязнь остаться одному в помещении", "Турофобия — боязнь сыра",
        "Антропофобия — боязнь людей", "Библиофобия — боязнь библиотек",
        "Гидрофобия — боязнь воды, утопления", "Агрофобия — боязнь городов",
        "Киберфобия — боязнь компьютеров", "Мусофобия — боязнь мышей и крыс",
        "Гаптофобия — боязнь прикосновений", "Акрофобия — боязнь высоты"
      ];
      phobias.forEach(phobia => {
        cards.push({ type: CardType.PHOBIA, value: phobia, description: phobia, rarity: phobia === 'Нет фобий' ? 'rare' : 'common' });
      });
      
      // Инвентарь (багаж)
      const luggage = [
        "Портативная рация", "Пакет с пакетами", "Набор для выживания",
        "Пауэрбанк на 3%", "Фильтр для воды", "Кулёк семечек", "Веревка 30 м",
        "Семена овощей", "Старая газета", "Старый ноутбук", "Тепловой плед",
        "Складная лопата", "Киндер сюрприз", "Гигиенический набор",
        "Аптечка расширенная", "Ручная дрель", "Машинный аккумулятор",
        "Хим. средства от вредителей", "Фермерский инкубатор с набором яиц",
        "Комплект фонариков", "1 миллион долларов", "Комплект для дайвинга",
        "Резиновая уточка", "Маникюрный набор", "Резиновые сапоги",
        "20 метров изоленты", "Радио и рация", "Сигнальная ракета",
        "Книга по выживанию", "Второй том 'Мертвых душ' Гоголя",
        "Флешка со всеми сериями Фиксиков", "Большой запас консервированных овощей",
        "Фильтры для воды", "Магнитофон и кассеты 80-х", "3 золотых слитка",
        "Комплект удочек и рыболовных снастей", "Гитара", "Семена кукурузы",
        "Учебники по анатомии", "Русско-вьетнамский словарь", "Книга рецептов",
        "Набор ножей", "Настольные игры", "10 саженцев фруктовых деревьев",
        "Рыбий жир", "Набор инструментов для механика", "Бензопила", "Противогаз",
        "Надувная лодка", "Набор для рисования", "Картонный Райан Гослинг",
        "Металлоискатель", "Беременная кошка", "Телевизор", "Игровой ноутбук",
        "25 метров металлической цепи и замок", "Месячный запас доширака",
        "Набор отмычек", "Вантуз"
      ];
      luggage.forEach(item => {
        cards.push({ type: CardType.INVENTORY, value: item, description: item, rarity: 'common' });
      });
      
      // Черты характера
      const characters = [
        "Импульсивный", "Расчётливый", "Замкнутый", "Веселый", "Параноидальный",
        "Добросердечный", "Манипулятор", "Ответственный", "Безрассудный",
        "Спокойный стратег", "Эмпатичный", "Упрямый", "Наглый", "Хозяйственный",
        "Великодушный", "Справедливый", "Оптимист", "Пессимист", "Безвольный",
        "Подлый", "Мудрый", "Беспринципный", "Храбрый", "Самоотверженный",
        "Аккуратный", "Высокомерный", "Добрый", "Надежный", "Конфликтный",
        "Лидер", "Назойливый", "Вспыльчивый", "Хладнокровный", "Буйный",
        "Грубый", "Истеричный", "Сострадательный", "Весёлый", "Общительный",
        "Спокойный", "Дружелюбный", "Стратег", "Самовлюблённый", "Решительный",
        "Психопат", "Терпеливый", "Заботливый", "Внимательный к деталям",
        "Нежный", "Социальный"
      ];
      characters.forEach(trait => {
        cards.push({ type: CardType.TRAIT, value: trait, description: trait, rarity: 'common' });
      });
      
      // Хобби
      const hobbies = [
        "Рукоделие", "Плавание", "Разговоры с домашними растениями", "Дайвинг",
        "Коллекционирование монет", "Игры на гитаре", "Туризм", "Пчеловодство",
        "Шахматы", "Фотография", "Рыбалка", "Выживание в дикой природе",
        "Ролевые игры", "Профессиональный поиск скидок (темщик)", "Хоббихорсер",
        "Паркур", "Азартные игры", "Танцы", "Охота", "Вязание", "Вышивка крестиком",
        "Метание ножей", "Альпинизм", "Навыки выживания", "Изучение карт",
        "Плетение ковров", "Бодибилдинг", "Фотоохота", "Тяжёлая атлетика",
        "Гимнастика", "Коллекционирование фантиков", "Садоводство",
        "Выращивание кабачков", "Муравьиная ферма", "Грибник",
        "Радиотехник-любитель", "Игра на гуслях", "Ремонт часов",
        "Куриная кулинария", "Макраме", "Прыжки в длину", "Прыжки с парашютом",
        "Плотницкое дело", "Создание чучел"
      ];
      hobbies.forEach(hobby => {
        cards.push({ type: CardType.HOBBY, value: hobby, description: hobby, rarity: 'common' });
      });
      
      // Возраст
      const ages = [
        { value: '18-25 лет', description: 'Молодой и энергичный' },
        { value: '26-35 лет', description: 'В расцвете сил' },
        { value: '36-45 лет', description: 'Опытный' },
        { value: '46-55 лет', description: 'Зрелый' },
        { value: '56-65 лет', description: 'Мудрый' },
        { value: '65+ лет', description: 'Пожилой' },
        { value: '16-18 лет', description: 'Подросток' },
      ];
      ages.forEach(age => {
        cards.push({ type: CardType.AGE, value: age.value, description: age.description, rarity: 'common' });
      });
      
      // Специальные карты (доп. информация)
      const additionalInfo = [
        "Был участником научной экспедиции", "Может ориентироваться по звездам",
        "Понимает язык котов (или так думает)", "Знает язык жестов",
        "Может уснуть где угодно за 40 секунд", "Разбирается в мемах всех эпох",
        "Имеет опыт работы с генераторами", "Умеет готовить из ограниченных продуктов",
        "Разбирается в радиосвязи", "Участвовал в спортивных соревнованиях",
        "Хорошо запоминает маршруты", "Имеет опыт жизни в горах",
        "Проходил курсы борьбы с тараканами… в голове", "Может подбодрить даже камень",
        "Рос в семье фермеров", "Рос в семье геологов",
        "Имеет ютуб канал с миллионом подписчиков", "Изучал воду и её очищение",
        "Знает на изусть все песни Ларисы Долиной", "Знает координаты бункера с медиками",
        "Знает координаты склада с продуктами", "Умеет считать большие числа в уме",
        "Часто ходил в походы", "Задерживает дыхание на 10 минут",
        "Пролежал в коме 3 года", "Работал нейрохирургом",
        "Открыты водительские права по всем категориям", "Умеет водить вертолёт",
        "Архитектор по первому образованию", "Садится на шпагат",
        "Достаёт языком до носа", "Превосходно знает местность",
        "Находится в федеральном розыске", "Может оказать первую помощь",
        "Покорил Эверест", "Состоит в клубе 'Навыки выживания' уже 5 лет",
        "Незаконченное медицинское образование", "Сбежал из психбольницы",
        "Выжил после удара молнии", "Победил медведя", "Знает азбуку морзе",
        "Знает 10 иностранных языков", "Планирует восстание машин",
        "Знает всё про компьютеры", "Любит вкусно покушать",
        "Делает зарядку каждое утро", "Часто теряет сознание",
        "Принимал роды на дому", "Пишет стихи и песни",
        "Ни дня не работал по профессии", "Не закончил школу",
        "Поёт рэп под псевдонимом", "Всегда носит шапочку из фольги",
        "Помнит на изусть каждую серию 'Сватов'"
      ];
      additionalInfo.forEach(special => {
        cards.push({ type: CardType.SPECIAL, value: special, description: special, rarity: 'common' });
      });

      await cardRepo.save(cards);
      console.log('✅ Seeded cards');
    }

    console.log('✅ Database seeding completed successfully!');
    return true;
  } catch (error) {
    console.error('❌ Error seeding database:', error);
    throw error;
  }
}
